{% extends 'base.html' %}

{% block title %}
  {% if form.instance.pk %}
    Edit User - Dreambook Salon
  {% else %}
    Create User - Dreambook Salon
  {% endif %}
{% endblock %}

{% block content %}
<div class="container-custom py-12">
  <!-- Header -->
  <div class="mb-8 animate-slide-up">
    <div class="flex items-center justify-between gap-4">
      <div>
        {% if form.instance.pk %}
          <h1 class="text-4xl font-bold text-gradient mb-2">Edit User</h1>
          <p class="text-light-muted">Update user details and permissions</p>
        {% else %}
          <h1 class="text-4xl font-bold text-gradient mb-2">Create New User</h1>
          <p class="text-light-muted">Add a new staff member or admin to your team</p>
        {% endif %}
      </div>
      <a href="{% url 'core:user_list' %}" class="btn btn-ghost text-lg">
        ‚Üê Back to Users
      </a>
    </div>
  </div>

  <!-- Form Card -->
  <div class="card p-8 max-w-2xl mx-auto">
    {% if form.non_field_errors %}
      <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded">
        <h3 class="text-red-700 font-semibold mb-2">Form Error</h3>
        {% for error in form.non_field_errors %}
          <p class="text-red-600 text-sm">{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" class="space-y-6">
      {% csrf_token %}

      <!-- Email Field -->
      <div>
        <label for="{{ form.email.id_for_label }}" class="block text-sm font-semibold text-light-text mb-2">
          Email Address <span class="text-red-600">*</span>
        </label>
        <input
          type="email"
          name="email"
          id="{{ form.email.id_for_label }}"
          value="{{ form.email.value|default:'' }}"
          {% if form.instance.pk %}disabled{% endif %}
          class="input w-full {% if form.email.errors %}border-red-500{% endif %}"
          placeholder="user@example.com"
          required>
        {% if form.email.help_text %}
          <p class="text-xs text-light-muted mt-1">{{ form.email.help_text|safe }}</p>
        {% endif %}
        {% if form.email.errors %}
          <div class="text-red-600 text-sm mt-1">
            {% for error in form.email.errors %}
              <p>‚Ä¢ {{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}
        {% if form.instance.pk %}
          <p class="text-xs text-light-muted mt-1">üìå Email cannot be changed after creation</p>
        {% endif %}
      </div>

      <!-- First Name Field -->
      <div>
        <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-semibold text-light-text mb-2">
          First Name
        </label>
        <input
          type="text"
          name="first_name"
          id="{{ form.first_name.id_for_label }}"
          value="{{ form.first_name.value|default:'' }}"
          class="input w-full {% if form.first_name.errors %}border-red-500{% endif %}"
          placeholder="John">
        {% if form.first_name.errors %}
          <div class="text-red-600 text-sm mt-1">
            {% for error in form.first_name.errors %}
              <p>‚Ä¢ {{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Last Name Field -->
      <div>
        <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-semibold text-light-text mb-2">
          Last Name
        </label>
        <input
          type="text"
          name="last_name"
          id="{{ form.last_name.id_for_label }}"
          value="{{ form.last_name.value|default:'' }}"
          class="input w-full {% if form.last_name.errors %}border-red-500{% endif %}"
          placeholder="Doe">
        {% if form.last_name.errors %}
          <div class="text-red-600 text-sm mt-1">
            {% for error in form.last_name.errors %}
              <p>‚Ä¢ {{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Role Field -->
      <div>
        <label for="{{ form.role.id_for_label }}" class="block text-sm font-semibold text-light-text mb-2">
          User Role <span class="text-red-600">*</span>
        </label>
        <select
          name="role"
          id="{{ form.role.id_for_label }}"
          class="input w-full {% if form.role.errors %}border-red-500{% endif %}"
          required>
          <option value="">-- Select a role --</option>
          {% for value, label in roles %}
            <option value="{{ value }}" {% if form.role.value == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
        {% if form.role.help_text %}
          <p class="text-xs text-light-muted mt-2">{{ form.role.help_text|safe }}</p>
        {% endif %}
        {% if form.role.errors %}
          <div class="text-red-600 text-sm mt-1">
            {% for error in form.role.errors %}
              <p>‚Ä¢ {{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Role Descriptions -->
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="p-3 bg-red-50 rounded border border-red-200">
            <h4 class="font-semibold text-red-700 text-sm mb-1">üëë Admin</h4>
            <p class="text-xs text-red-600">Full system access, user management, all reports</p>
          </div>
          <div class="p-3 bg-primary-50 rounded border border-primary-200">
            <h4 class="font-semibold text-primary-700 text-sm mb-1">üíº Staff</h4>
            <p class="text-xs text-primary-600">Can view appointments, manage bookings, view reports</p>
          </div>
          <div class="p-3 bg-blue-50 rounded border border-blue-200">
            <h4 class="font-semibold text-blue-700 text-sm mb-1">üë§ Customer</h4>
            <p class="text-xs text-blue-600">Standard customer account, book appointments</p>
          </div>
        </div>
      </div>

      <!-- Status Field (Edit Only) -->
      {% if form.instance.pk %}
        <div class="pt-4 border-t border-light-border">
          <label for="{{ form.is_active.id_for_label }}" class="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              name="is_active"
              id="{{ form.is_active.id_for_label }}"
              {% if form.is_active.value %}checked{% endif %}
              class="w-4 h-4 accent-primary-600">
            <span class="text-sm font-semibold text-light-text">
              User is Active
            </span>
          </label>
          <p class="text-xs text-light-muted mt-2 ml-7">
            Unchecking this will deactivate the user without deleting their account
          </p>
        </div>
      {% endif %}

      <!-- Form Actions -->
      <div class="pt-6 border-t border-light-border flex gap-3 justify-end">
        <a href="{% url 'core:user_list' %}" class="btn btn-ghost">
          Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          {% if form.instance.pk %}
            üíæ Save Changes
          {% else %}
            ‚ú® Create User
          {% endif %}
        </button>
      </div>
    </form>
  </div>

  <!-- Additional Info Section -->
  <div class="mt-8 max-w-2xl mx-auto">
    <div class="card p-6 bg-light-bg">
      <h3 class="text-lg font-bold text-light-text mb-4">üìã Important Information</h3>
      <ul class="space-y-2 text-sm text-light-muted">
        <li class="flex gap-3">
          <span class="text-primary-600 font-bold">‚Ä¢</span>
          <span>A temporary password will be generated and sent to the user's email</span>
        </li>
        <li class="flex gap-3">
          <span class="text-primary-600 font-bold">‚Ä¢</span>
          <span>Users must change their password on first login</span>
        </li>
        <li class="flex gap-3">
          <span class="text-primary-600 font-bold">‚Ä¢</span>
          <span>Email addresses must be unique in the system</span>
        </li>
        <li class="flex gap-3">
          <span class="text-primary-600 font-bold">‚Ä¢</span>
          <span>All user actions are logged to the audit trail for compliance</span>
        </li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
