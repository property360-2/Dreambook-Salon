{% extends 'base.html' %}

{% block title %}Payment Details · Dreambook Salon{% endblock title %}

{% block content %}
  <section class="page-payment-detail">
    <header class="page-payment-detail__header">
      <h1>Payment Details</h1>
      {% include 'components/atoms/badge.html' with label=payment.get_status_display style='primary' %}
    </header>

    <div class="page-payment-detail__content">
      <div class="page-payment-detail__main">
        <h2>Payment Information</h2>

        <div class="page-payment-detail__info">
          <div class="page-payment-detail__info-item">
            <strong>Transaction ID:</strong> {{ payment.txn_id }}
          </div>
          <div class="page-payment-detail__info-item">
            <strong>Amount:</strong> ₱{{ payment.amount }}
          </div>
          <div class="page-payment-detail__info-item">
            <strong>Payment Method:</strong> {{ payment.get_method_display }}
          </div>
          <div class="page-payment-detail__info-item">
            <strong>Status:</strong> {{ payment.get_status_display }}
          </div>
          <div class="page-payment-detail__info-item">
            <strong>Created:</strong> {{ payment.created_at|date:"F d, Y g:i A" }}
          </div>
          <div class="page-payment-detail__info-item">
            <strong>Last Updated:</strong> {{ payment.updated_at|date:"F d, Y g:i A" }}
          </div>
        </div>

        {% if payment.notes %}
          <div class="page-payment-detail__notes">
            <h3>Payment Notes</h3>
            <p>{{ payment.notes }}</p>
          </div>
        {% endif %}

        <div class="page-payment-detail__appointment">
          <h3>Appointment Details</h3>
          <div class="page-payment-detail__appointment-info">
            <div class="page-payment-detail__info-item">
              <strong>Service:</strong> {{ payment.appointment.service.name }}
            </div>
            <div class="page-payment-detail__info-item">
              <strong>Date & Time:</strong> {{ payment.appointment.start_at|date:"F d, Y g:i A" }}
            </div>
            <div class="page-payment-detail__info-item">
              <strong>Customer:</strong> {{ payment.appointment.customer.get_full_name|default:payment.appointment.customer.email }}
            </div>
          </div>
          <a href="{% url 'appointments:detail' payment.appointment.id %}" class="atom-button atom-button--ghost">
            View Appointment
          </a>
        </div>
      </div>

      <aside class="page-payment-detail__actions">
        {% if payment.status == 'FAILED' and user.role == 'CUSTOMER' and payment.appointment.customer == user %}
          <form method="post" action="{% url 'payments:retry' payment.id %}">
            {% csrf_token %}
            {% include 'components/atoms/button.html' with label='Retry Payment' style='primary' type='submit' %}
          </form>
        {% endif %}

        <a href="{% url 'payments:list' %}" class="atom-button atom-button--ghost">
          ← Back to Payments
        </a>
      </aside>
    </div>
  </section>
{% endblock content %}
