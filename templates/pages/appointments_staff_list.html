{% extends 'base.html' %}

{% block title %}All Appointments Â· Dreambook Salon{% endblock title %}

{% block content %}
  <div class="container-custom py-12">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-12 gap-4">
      <div>
        <h1 class="text-4xl font-bold text-gradient mb-2">All Appointments</h1>
        <p class="text-light-muted">Manage and track all salon appointments</p>
      </div>
      <div class="flex gap-2">
        <a href="{% url 'appointments:slotlimit_list' %}" class="btn bg-purple-500/10 text-purple-400 border border-purple-500/20 hover:bg-purple-500/20 whitespace-nowrap">
          Manage Slot Limits
        </a>
        <a href="{% url 'analytics:dashboard' %}" class="btn btn-ghost whitespace-nowrap">
          View Analytics
        </a>
      </div>
    </div>

    <!-- Calendar Section -->
    <div class="mb-12">
      {% include 'components/molecules/appointment_calendar.html' %}
    </div>

    <!-- Main Content Grid: Filters + Table Side by Side -->
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-6">
      <!-- Filters Sidebar -->
      <div class="lg:col-span-1">
        <form method="get" class="card p-6 sticky top-24">
          <h3 class="text-lg font-bold text-light-text mb-4">Filters</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-light-text mb-2">Status</label>
              <select name="status" class="input">
                <option value="">All</option>
                {% for value, label in status_choices %}
                  <option value="{{ value }}" {% if value == current_status %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-semibold text-light-text mb-2">From Date</label>
              <input type="date" name="from_date" value="{{ request.GET.from_date }}" class="input">
            </div>

            <div>
              <label class="block text-sm font-semibold text-light-text mb-2">To Date</label>
              <input type="date" name="to_date" value="{{ request.GET.to_date }}" class="input">
            </div>

            <div class="flex flex-col gap-2">
              <button type="submit" class="btn btn-primary w-full">Apply Filters</button>
              <a href="{% url 'appointments:staff_list' %}" class="btn btn-ghost w-full">Clear Filters</a>
            </div>
          </div>
        </form>
      </div>

      <!-- Table Section -->
      <div class="lg:col-span-4">
        {% if appointments %}
          <!-- Appointments Table -->
          <div class="card overflow-hidden mb-6">
            <div class="overflow-x-auto">
              <table class="table">
                <thead>
                  <tr>
                    <th>Date & Time</th>
                    <th>Customer</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for appointment in appointments %}
                    <tr>
                      <td>
                        <div class="font-semibold text-light-text">{{ appointment.start_at|date:"M d, Y" }}</div>
                        <div class="text-sm text-primary-600">{{ appointment.start_at|date:"g:i A" }}</div>
                      </td>
                      <td class="text-light-text">{{ appointment.customer.get_full_name|default:appointment.customer.email }}</td>
                      <td class="text-light-text font-semibold">{{ appointment.service.name }}</td>
                      <td>
                        {% if appointment.status == 'CONFIRMED' %}
                          <span class="badge badge-success">{{ appointment.get_status_display }}</span>
                        {% elif appointment.status == 'PENDING' %}
                          <span class="badge badge-warning">{{ appointment.get_status_display }}</span>
                        {% elif appointment.status == 'IN_PROGRESS' %}
                          <span class="badge badge-info">{{ appointment.get_status_display }}</span>
                        {% elif appointment.status == 'COMPLETED' %}
                          <span class="badge badge-success">{{ appointment.get_status_display }}</span>
                        {% elif appointment.status == 'NO_SHOW' %}
                          <span class="badge badge-danger">{{ appointment.get_status_display }}</span>
                        {% else %}
                          <span class="badge badge-danger">{{ appointment.get_status_display }}</span>
                        {% endif %}
                      </td>
                      <td>
                        {% if appointment.payment_state == 'PAID' %}
                          <span class="badge badge-success">{{ appointment.get_payment_state_display }}</span>
                        {% else %}
                          <span class="badge badge-warning">{{ appointment.get_payment_state_display }}</span>
                        {% endif %}
                      </td>
                      <td>
                        <a href="{% url 'appointments:detail' appointment.id %}" class="text-primary-600 hover:text-primary-300 font-semibold text-sm">
                          View Details
                        </a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Pagination -->
          {% if is_paginated %}
            <nav class="flex items-center justify-center gap-4">
              {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode }}" class="btn btn-ghost">
                  Previous
                </a>
              {% else %}
                <span class="btn btn-ghost opacity-50 cursor-not-allowed">Previous</span>
              {% endif %}

              <span class="text-light-muted">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
              </span>

              {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}" class="btn btn-ghost">
                  Next
                </a>
              {% else %}
                <span class="btn btn-ghost opacity-50 cursor-not-allowed">Next</span>
              {% endif %}
            </nav>
          {% endif %}
        {% else %}
          <!-- Empty State -->
          <div class="card p-12 text-center">
            <div class="text-6xl mb-4">ðŸ“…</div>
            <h3 class="text-2xl font-bold text-light-text mb-2">No appointments found</h3>
            <p class="text-light-muted">No appointments match your current filters</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock content %}
